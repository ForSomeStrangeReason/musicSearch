<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Поиск в таблице</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #CABA9C;
            overflow: hidden;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        input[type="text"] {
            width: 80vw;
            padding: 20px;
            font-size: 20px;
            border: 5px solid #8A6240;
            border-radius: 5px;
            margin-right: 10px;
            background-color: #CABA9C;
        }

        input[type="text"]::placeholder {
            color: #8A6240;
            opacity: 1;
            font-weight: bold;
        }

        .clear {
            background-color: #8A6240;
            color: #CABA9C;
            padding: 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .results {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: 40vw;
            max-width: 600px;
            min-width: 300px;
            border: 5px solid #8A6240;
            padding: 20px;
            border-radius: 5px;
            background-color: #CABA9C;
            margin-bottom: 20px;
            transition: width 0.3s ease-in-out;
            min-height: calc(5 * 1.25em);
            max-height: calc(5 * 1.25em);
            overflow: hidden;
            margin-left: auto;
            margin-right: auto;
            margin-left: 7vw;
        }


        a {
            color: #8A6240;
        }

        .results div {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>

<body>
    <div class="input-wrapper">
        <input type="text" id="search1" oninput="searchColumn(0)" placeholder="Поиск по названиям" />
        <button class="clear" onclick="clearInput(1)">x</button>
    </div>
    <div id="results1" class="results"></div>

    <div class="input-wrapper">
        <input type="text" id="search2" oninput="searchColumn(1)" placeholder="Поиск по ссылкам" />
        <button class="clear" onclick="clearInput(2)">x</button>
    </div>
    <div id="results2" class="results"></div>

    <script>
        let tableData = [];
        let allResults = [];

        async function fetchData() {
            const response = await fetch('https://docs.google.com/spreadsheets/d/1xtPPGOo4dvx3ifNf7ZBPKAxmKYMq9b9SMrJgBlyiEWM/export?format=csv');
            if (!response.ok) {
                console.error('Ошибка при загрузке данных:', response.status, response.statusText);
                return;
            }
            const csvData = await response.text();
            const rows = csvData.split('\n');
            const tableData = rows.map(row => row.split(','));
            console.log(tableData);
            const filteredData = tableData.slice(1).map(row => ({
                column1: row[0],
                column3: row[2]
            }));

            console.log(filteredData);
        }


        function transliterate(text) {
            const translitMap = {
                а: 'a', б: 'b', в: 'v', г: 'g', д: 'd', е: 'e', ё: 'yo', ж: 'zh', з: 'z', и: 'i',
                й: 'y', к: 'k', л: 'l', м: 'm', н: 'n', о: 'o', п: 'p', р: 'r', с: 's', т: 't',
                у: 'u', ф: 'f', х: 'h', ц: 'ts', ч: 'ch', ш: 'sh', щ: 'shch', ы: 'y', э: 'e',
                ю: 'yu', я: 'ya', А: 'A', Б: 'B', В: 'V', Г: 'G', Д: 'D', Е: 'E', Ё: 'Yo', Ж: 'Zh',
                З: 'Z', И: 'I', Й: 'Y', К: 'K', Л: 'L', М: 'M', Н: 'N', О: 'O', П: 'P', Р: 'R',
                С: 'S', Т: 'T', У: 'U', Ф: 'F', Х: 'H', Ц: 'Ts', Ч: 'Ch', Ш: 'Sh', Щ: 'Shch',
                Ы: 'Y', Э: 'E', Ю: 'Yu', Я: 'Ya'
            };
            text = text.replace(/[-']/g, '');
            text = text.replace(/\s+/g, ' ');
            return text.split('').map(char => translitMap[char] || char).join('');
        }

        function normalizeInput(input) {
            return input.replace(/[-']/g, '').replace(/\s+/g, ' ').trim();
        }

        function searchColumn(column) {
            const input = document.getElementById(`search${column + 1}`).value.toLowerCase();
            const resultsDiv1 = document.getElementById("results1");
            const resultsDiv2 = document.getElementById("results2");

            if (input === '') {
                resultsDiv1.innerHTML = '';
                resultsDiv2.innerHTML = '';
                return;
            }

            const transliteratedInput = transliterate(input);
            const results = tableData.filter(row => {
                let columnValue = column === 0 ? row.column1 : row.column3;
                return columnValue && (
                    columnValue.toLowerCase().includes(input) ||
                    transliterate(columnValue).toLowerCase().includes(transliteratedInput)
                );
            });

            allResults = results;
            displayResults(results.slice(0, 5), resultsDiv1, resultsDiv2);

            if (results.length > 5) {
                resultsDiv1.innerHTML += '<div class="more-btn" onclick="showMoreResults()">...</div>';
                resultsDiv2.innerHTML += '<div class="more-btn" onclick="showMoreResults()">...</div>';
            }
        }

        function displayResults(results, resultsDiv1, resultsDiv2) {
            resultsDiv1.innerHTML = results.length
                ? results.map(row => `<div>${row.column1}</div>`).join('')
                : '<div>Ничего не найдено</div>';

            resultsDiv2.innerHTML = results.length
                ? results.map(row => row.column3 ? `<div><a href="${row.column3}" target="_blank">${row.column3}</a></div>` : '').join('')
                : '<div>Ничего не найдено</div>';
        }

        function showMoreResults() {
            displayResults(allResults, document.getElementById("results1"), document.getElementById("results2"));
        }

        function clearInput(inputNumber) {
            const input = document.getElementById(`search${inputNumber}`);
            input.value = '';
            searchColumn(inputNumber - 1);
            input.focus();
        }

        window.onload = fetchData;
    </script>
</body>

</html>